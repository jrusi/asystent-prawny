<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostyka połączenia</title>
</head>
<body>
    <h1>Diagnostyka połączenia z backendem</h1>
    <button onclick="testConnection()">Test połączenia</button>
    <pre id="results"></pre>
    
    <script>
        async function testConnection() {
            const resultsElem = document.getElementById('results');
            resultsElem.textContent = 'Testowanie połączenia...';
            
            try {
                // Test 1: Sprawdź, czy frontend odpowiada
                resultsElem.textContent += '\n\nTest 1: Sprawdzenie frontendu...';
                const frontendResponse = await fetch('/debug.html');
                resultsElem.textContent += `\nFrontend: ${frontendResponse.status} ${frontendResponse.statusText}`;
                
                // Test 2: Sprawdź, czy można połączyć się z backendem przez /api
                resultsElem.textContent += '\n\nTest 2: Sprawdzenie backendu przez /api...';
                const backendResponse = await fetch('/api', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    resultsElem.textContent += `\nBackend: ${backendResponse.status} ${backendResponse.statusText}`;
                    resultsElem.textContent += `\nDane: ${JSON.stringify(data)}`;
                } else {
                    resultsElem.textContent += `\nBackend: ${backendResponse.status} ${backendResponse.statusText}`;
                    resultsElem.textContent += `\nBłąd: Nie można połączyć się z backendem`;
                }
                
                // Test 3: Sprawdź, czy można połączyć się z /api/check-services
                resultsElem.textContent += '\n\nTest 3: Sprawdzenie /api/check-services...';
                try {
                    const servicesResponse = await fetch('/api/check-services', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (servicesResponse.ok) {
                        const data = await servicesResponse.json();
                        resultsElem.textContent += `\nCheck Services: ${servicesResponse.status} ${servicesResponse.statusText}`;
                        resultsElem.textContent += `\nDane: ${JSON.stringify(data)}`;
                    } else {
                        resultsElem.textContent += `\nCheck Services: ${servicesResponse.status} ${servicesResponse.statusText}`;
                        throw new Error('Błąd odpowiedzi');
                    }
                } catch (error) {
                    resultsElem.textContent += `\nBłąd: ${error.message}`;
                    
                    // Próba bezpośredniego dostępu do backendu (może nie zadziałać ze względu na CORS)
                    resultsElem.textContent += '\n\nPróba bezpośredniego dostępu do backendu...';
                    try {
                        const directResponse = await fetch('http://localhost:8000/check-services', {
                            mode: 'no-cors' // To spowoduje, że nie będziemy mogli odczytać odpowiedzi
                        });
                        resultsElem.textContent += `\nBezpośredni dostęp: Zapytanie wysłane (brak możliwości odczytu odpowiedzi ze względu na CORS)`;
                    } catch (directError) {
                        resultsElem.textContent += `\nBłąd bezpośredniego dostępu: ${directError.message}`;
                    }
                }
                
            } catch (error) {
                resultsElem.textContent += `\n\nBłąd ogólny: ${error.message}`;
            }
        }
    </script>
</body>
</html>
